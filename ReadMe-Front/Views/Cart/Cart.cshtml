@model IEnumerable<ReadMe_Front.Models.ViewModels.CartVm>

@{
    ViewBag.Title = "Cart";
    Layout = "~/Views/Shared/_Layout2.cshtml"; // 指定 Layout
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="~/Content/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="~/Css/Repeat.css">
    <style>
        /* === 全局樣式設定 === */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f9f9f9;
            color: #333;
        }

        .container {
            max-width: 1000px;
        }

        header {
            text-align: center;
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }

        /* === 步驟進度區 === */
        .progress-section {
            padding: 20px;
            text-align: center;
        }

        .steps {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .step {
            padding: 10px 20px;
            border-bottom: 2px solid transparent;
        }

            .step.active {
                color: #007bff;
            }

        /* === 購物車區 === */
        .cart-section {
            padding: 20px;
            background-color: #fff;
            margin: 8px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

            .item-info img {
                width: 100px;
                height: auto;
            }

        .item-actions {
            text-align: right;
        }

            .item-actions button {
                background-color: orangered;
                color: #fff;
                border: none;
                padding: 5px 10px;
                cursor: pointer;
            }

                .item-actions button:hover {
                    background-color: #d32f2f;
                }


        /* === 結算區 === */
        .summary-section {
            width: 35%;
            background-color: #fff;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

            .summary-section h3 {
                font-size: 16px;
                color: #333;
                margin-bottom: 10px;
            }

        .summary-details {
            font-size: 14px;
            color: #333;
        }

            .summary-details div {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            .summary-details .total {
                font-size: 16px;
                font-weight: bold;
                color: #e60012;
            }

        /* 額外資訊欄 */
        .cart-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            font-size: 14px;
            color: #333;
            border-radius: 5px;
        }

        /* === 按鈕樣式 === */
        .actions {
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
        }

        .btn-secondary {
            background-color: #ccc;
            color: #333;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }

        .btn-primary {
            background-color: #f53d2d;
            color: #fff;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
        }

            .btn-primary:hover {
                background-color: #d32f2f;
            }

        /* 進度條 */
        .progress-section {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
        }

        .progress-bar {
            width: 100%;
            height: 2px;
            background-color: #e0e0e0;
            position: absolute;
            top: 15px;
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background-color: #40B3E9;
            transition: width 0.3s ease;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            position: relative;
            z-index: 2;
            gap: 100px;
        }

        .step {
            text-align: center;
            color: #999;
            transition: all 0.3s ease;
        }

        .step-circle {
            width: 28px;
            height: 28px;
            background-color: #ccc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-size: 14px;
            color: white;
        }

        .step.active .step-circle {
            background-color: #40B3E9;
        }

        .step-label {
            margin-top: 0.5rem;
            font-size: 14px;
        }

        .step.active .step-label {
            color: #40B3E9;
        }

        .check {
            background-color: #40B3E9;
        }

        /* 標籤列 */

        .cart-header {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
        }

        /* === 優惠碼區 === */
        .coupon-and-summary {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            /* border: 1px solid #ddd; */
            border-radius: 5px;
        }

        .coupon-section {
            width: 60%;
        }

            .coupon-section h3 {
                margin-bottom: 10px;
                font-size: 18px;
                color: #333;
            }

        .coupon-link {
            display: block;
            margin-bottom: 15px;
            color: #007bff;
            text-decoration: none;
            font-size: 14px;
        }

            .coupon-link:hover {
                text-decoration: underline;
            }

        .coupon-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

            .coupon-input input {
                flex: 1;
                padding: 8px;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 14px;
            }

                .coupon-input input:focus {
                    border-color: #007bff;
                    outline: none;
                }

            .coupon-input button {
                padding: 8px 16px;
                background-color: #333;
                color: #fff;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.3s;
            }

                .coupon-input button:hover {
                    background-color: #555;
                }

        .coupon-section p {
            font-size: 12px;
            color: #666;
        }

        /* 彈出視窗 */
        .modal {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            width: 50%;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
        }

        .coupon-list {
            list-style: none;
            padding: 0;
        }

            .coupon-list li {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #ddd;
                padding: 10px 0;
            }

        .btn-use {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

            .btn-use:hover {
                background-color: #0056b3;
            }

        /* 訂單摘要區 */
        .summary-section {
            width: 35%;
            text-align: right;
        }

            .summary-section p {
                font-size: 14px;
                margin-bottom: 10px;
            }

        .summary div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .red {
            color: red;
        }

        .total {
            font-size: 16px;
            font-weight: bold;
            color: #f56c6c;
        }
        /* 折價區 */
        .discount-container {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #fff;
            margin: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

            .discount-container h3 {
                font-size: 16px;
                color: #333;
                margin-bottom: 10px;
            }

        .discount-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

            .discount-list li {
                font-size: 14px;
                margin-bottom: 8px;
                color: #000;
                display: flex;
                justify-content: space-between;
            }

            .discount-list .warning {
                color: red;
                font-weight: bold;
            }

        .discount {
            margin-top: 5px; /* 與上一行間距 */
            display: block; /* 強制換行 */
            color: red; /* 可選：設定折扣顏色 */
        }
    </style>
</head>
<body>
    <div class="container " id="app">
        <!-- 導覽 strat -->
        <progress-component :current-page="1"></progress-component>
        <!-- 導覽 end -->
        <!-- 標籤類 -->
        <div class="cart-header">
            <div class="" style="padding-right: 5px;">商品資訊</div>
            <div class="">售價</div>
        </div>
        <!-- 商品列表區  start-->
        <div id="app" class="container">
            <section class="cart-section">
                <!-- 使用 Vue 的 v-for 渲染多個商品 -->
                <div v-for="(item, index) in cartItems" :key="index" class="cart-item">
                    <!-- 商品項目 -->
                    <div class="item-info">
                        <input type="checkbox" v-model="item.checked">
                        <img :src="item.image" :alt="item.Title">
                        <div>
                            <h3>{{ item.Title }}</h3>
                            <p>出版社：{{ item.Publisher }}</p>
                            <p>作者：{{ item.Author }}</p>
                        </div>
                    </div>
                    <div class="item-actions">
                        <span>價格：NT$ {{ item.Price }}</span>
                        <button type="button" class="btn btn-secondary btn-sm ms-2" v-on:click="addToWishlist(item)">
                            加入待購清單
                        </button>
                        <button type="button" class="btn-remove btn btn-secondary btn-sm ms-2" v-on:click="removeItem(index)">
                            移除
                        </button>
                    </div>
                </div>
            </section>
        </div>


        <!-- 商品列表區  end-->

        <div class="discount-container">
            <h3>全館優惠折扣</h3>
            <ul class="discount-list">
                <li v-for="(item, index) in discounts" :key="index">
                    <span>{{ item.description }}</span>
                    <span class="warning">({{ item.warning }})</span>
                </li>
            </ul>
        </div>

        <!-- 結算區 start-->
        <div class="coupon-and-summary">
            <!-- 優惠碼區 -->
            <div class="coupon-section container">
                <h3>使用優惠碼</h3>
                <a href="#" class="coupon-link" v-on:click.prevent="openModal">選擇您可使用的優惠碼（共 {{ coupons.length }} 組）</a>
                <div class="d-flex">
                    <input placeholder="請輸入或選擇您可使用的優惠碼" type="text" class="form-control" value="">
                    <button type="button" class="btn-square btn btn-others text-nowrap btn-dark">使用</button>
                </div>
                <!-- 彈出視窗 -->
                <div class="modal" v-if="isModalOpen">
                    <div class="modal-content">
                        <span class="close" v-on:click="closeModal">&times;</span>
                        <h3>選擇優惠碼</h3>
                        <ul class="coupon-list">
                            <li v-for="(coupon, index) in coupons" :key="index">
                                <div>{{ coupon.code }}</div>
                                <div>{{ coupon.description }}</div>
                                <div>{{ coupon.expiry }}</div>
                                <button class="btn-use" v-on:click="useCoupon(coupon.code)">使用</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 結算區 -->
            <div class="summary-section">
                <h3>共選取 <span>1</span> 件商品</h3>
                <div class="summary-details">
                    <div>
                        <span>訂單小計：</span>
                        <span>NT$ 252</span>
                    </div>
                    <div>
                        <span>促銷折抵：</span>
                        <span>-NT$ 0</span>
                    </div>
                    <div class="total">
                        <span>訂單總計：</span>
                        <span>NT$ 252</span>
                    </div>
                </div>
            </div>
        </div>
        <!-- 結算區 end-->
        <div class="d-flex justify-content-between">
            <a href="#" class="btn btn-light btn-lg rounded-pill px-5">&larr; 繼續逛逛</a>
            <a href="/OrderDetails.html" class="btn btn-light btn-lg rounded-pill px-5">付款 &rarr;</a>
        </div>


    </div>
    <script src="~/Js/vue.global.js"></script>
    <script src="~/Js/Repeat.js"></script>
    <script src="~/Js/Api.js"></script>
    <script>

        const { createApp, ref, onMounted } = Vue;

        // Vue 應用設定
        const config = {
            setup() {
                // 定義狀態
                const isModalOpen = ref(false); // 控制彈出視窗顯示
                const coupons = ref([
                    {
                        code: 'WLCM-H2GGFWWQB',
                        description: '新會員歡迎禮 - 註冊送電子書單筆滿250元現折50元',
                        expiry: '2025/1/19 到期',
                    },
                ]);

                const cartItems = ref([]); // 購物車資料
                // 獲取購物車資料
                //const fetchCartItems = async () => {
                //    try {
                //        const data = await Api.fetchCart(); // 調用全域 API 方法
                //        cartItems.value = data;
                //    } catch (error) {
                //        if (error.message.includes("帳號為空")) {
                //            alert("請輸入有效帳號！");
                //        } else if (error.message.includes("找不到購物車資料")) {
                //            alert("目前購物車內沒有任何商品！");
                //        } else {
                //            alert("無法取得購物車資料，請稍後再試！");
                //        }
                //    }
                //};
                const fetchCartItems = async () => {
                    try {
                        const data = await Api.fetchCart(); // 調用 API 方法
                        cartItems.value = data;
                        console.log("從 API 獲取的購物車資料：", cartItems.value);
                    } catch (error) {
                        console.error("無法獲取購物車資料：", error.message);
                        alert("獲取購物車資料時發生錯誤！");
                    }
                };



               
                const discounts = ref([
                    { description: "1/31前，飯田出版社會員專屬展，三本79折", warning: "尚缺2件" },
                    { description: "1/11前，村上書籍書展，三本以上85折", warning: "尚缺2件" },
                ]);

                // 定義方法
                const addToWishlist = (item) => {
                    alert(`已將「${item.name}」加入待購清單！`);
                };

                const removeItem = (index) => {
                    cartItems.value = cartItems.value.filter((_, i) => i !== index);
                };

                const openModal = () => {
                    isModalOpen.value = true;
                };

                const closeModal = () => {
                    isModalOpen.value = false;
                };

                const useCoupon = (code) => {
                    alert(`使用優惠碼: ${code}`);
                    closeModal();
                };

                onMounted(() => {
                    fetchCartItems();
                
                });

                return {
                    cartItems,
                    addToWishlist,
                    removeItem,
                    isModalOpen,
                    coupons,
                    discounts,
                    openModal,
                    closeModal,
                    useCoupon,
                };
            },
        };

        const app = createApp(config);
        app.component("progress-component", Progress)
        app.mount("#app");
    </script>


</body>
</html>
